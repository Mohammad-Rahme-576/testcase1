<!DOCTYPE html>
<html dir="rtl" lang="ar">
<!--
============================================
EXCEL EXPORT TEST & DEMO PAGE
============================================

Purpose:
- Test Excel export functionality before production
- Generate sample data for demonstrations
- Verify data format and structure

Features:
- Add test data with 3 different entry types
- Export to Excel and verify output
- View stored data in browser
- Clear all test data

Usage:
1. Click "Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©" to add sample data
2. Click "ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel" to test export
3. Open Excel file to verify formatting
4. Use "Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" to reset

@author Lebanon War Damage Assessment Team
============================================
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± - Ù†Ù…ÙˆØ°Ø¬ Ø­ØµØ± Ø§Ù„Ø£Ø¶Ø±Ø§Ø±</title>
    
    <!-- SheetJS Library for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            direction: rtl;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            font-weight: bold;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #2196f3;
        }
        .success {
            background: #d4edda;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            color: #155724;
            display: none;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            direction: ltr;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</h1>
        
        <div class="info">
            <h3>ğŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ§Øª:</h3>
            <ol>
                <li>Ø£ÙˆÙ„Ø§Ù‹: Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
                <li>Ø«Ø§Ù†ÙŠØ§Ù‹: ØµØ¯Ù‘Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù Excel</li>
                <li>Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙˆØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</li>
            </ol>
        </div>

        <button onclick="addTestData()">1ï¸âƒ£ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        <button onclick="exportToExcel()">2ï¸âƒ£ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
        <button onclick="viewStoredData()">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©</button>
        <button onclick="clearAllData()" style="background: #dc3545;">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        
        <div class="success" id="message"></div>
        <div id="dataDisplay"></div>
    </div>

    <script>
        function addTestData() {
            // Clear existing test data
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key && key.startsWith('submission_')) {
                    localStorage.removeItem(key);
                }
            }

            // Test Data 1: Single Entry
            const data1 = {
                timestamp: new Date().toLocaleString('ar-LB'),
                sector: 'Ù‚Ø·Ø§Ø¹ ØµÙˆØ±',
                village: 'ØµÙˆØ±',
                neighborhood: 'Ø­ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
                buildingName: 'Ø¨Ø±Ø¬ Ø§Ù„Ø³Ù„Ø§Ù…',
                streetName: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ø­Ù…Ø±Ø§Ø¡',
                propertyNumber: '103',
                sectionNumber: '5',
                isInBuilding: true,
                blockNumber: '12',
                buildingCount: '8',
                buildingType: 'Ø³ÙƒÙ†ÙŠ',
                floors: '4',
                floorNumber: '2',
                sectionType: 'Ù…Ù†Ø²Ù„',
                direction: 'Ø´Ù…Ø§Ù„',
                fullName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                motherName: 'ÙØ§Ø·Ù…Ø© Ø­Ø³ÙŠÙ†',
                registry: 'ØµÙˆØ±/1985',
                phone: '03123456'
            };

            // Test Data 2: My Floors Entry
            const data2 = {
                timestamp: new Date().toLocaleString('ar-LB'),
                sector: 'Ù‚Ø·Ø§Ø¹ Ø¨Ù†Øª Ø¬Ø¨ÙŠÙ„',
                village: 'Ø¨Ù†Øª Ø¬Ø¨ÙŠÙ„',
                neighborhood: 'Ø­ÙŠ Ø§Ù„Ø¬Ù†ÙˆØ¨',
                buildingName: 'Ø¨Ù†Ø§ÙŠØ© Ø§Ù„Ù†ÙˆØ±',
                streetName: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©',
                propertyNumber: '207',
                sectionNumber: '3',
                isInBuilding: false,
                buildingType: 'Ø³ÙƒÙ†ÙŠ',
                floors: '5',
                floorNumber: '1',
                sectionType: 'Ù…Ù†Ø²Ù„',
                direction: 'Ø´Ø±Ù‚',
                fullName: 'Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† ÙƒØ±ÙŠÙ…',
                motherName: 'Ø²ÙŠÙ†Ø¨ Ø£Ø­Ù…Ø¯',
                registry: 'Ø¨Ù†Øª Ø¬Ø¨ÙŠÙ„/1990',
                phone: '03234567',
                myFloors: [
                    {
                        floorNumber: '3',
                        sectionType: 'Ù…Ø­Ù„',
                        direction: 'ØºØ±Ø¨',
                        registrantName: 'Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯'
                    },
                    {
                        floorNumber: '4',
                        sectionType: 'Ù…ÙƒØªØ¨',
                        direction: 'Ø¬Ù†ÙˆØ¨',
                        registrantName: 'Ø­Ø³Ù† Ø¹Ù„ÙŠ'
                    }
                ]
            };

            // Test Data 3: Full Building Entry
            const data3 = {
                timestamp: new Date().toLocaleString('ar-LB'),
                sector: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø­ÙˆØ´',
                village: 'Ø§Ù„Ø­ÙˆØ´',
                neighborhood: 'Ø­ÙŠ Ø§Ù„Ø¨Ø³ØªØ§Ù†',
                buildingName: 'Ø¹Ù…Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù…Ø©',
                streetName: 'Ø§Ù„Ø´Ø§Ø±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                propertyNumber: '456',
                sectionNumber: '8',
                isInBuilding: true,
                blockNumber: '5',
                buildingCount: '12',
                buildingType: 'Ø³ÙƒÙ†ÙŠ ØªØ¬Ø§Ø±ÙŠ',
                floors: '6',
                fullName: 'Ø®Ø§Ù„Ø¯ ÙŠÙˆØ³Ù',
                motherName: 'Ù„ÙŠÙ„Ù‰ Ø­Ø³Ù†',
                registry: 'Ø§Ù„Ø­ÙˆØ´/1988',
                phone: '03345678',
                residents: [
                    {
                        fullName: 'Ø¹Ù…Ø± Ø®Ø§Ù„Ø¯',
                        motherName: 'Ø±Ù†Ø§ Ù…Ø­Ù…Ø¯',
                        registry: 'Ø§Ù„Ø­ÙˆØ´/2010',
                        phone: '03456789',
                        floor: '2',
                        sectionType: 'Ù…Ù†Ø²Ù„',
                        direction: 'Ø´Ù…Ø§Ù„'
                    },
                    {
                        fullName: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
                        motherName: 'Ù†ÙˆØ± Ø¹Ù„ÙŠ',
                        registry: 'Ø§Ù„Ø­ÙˆØ´/2012',
                        phone: '03567890',
                        floor: '3',
                        sectionType: 'Ø¹ÙŠØ§Ø¯Ø©',
                        direction: 'Ø¬Ù†ÙˆØ¨'
                    },
                    {
                        fullName: 'ÙƒØ±ÙŠÙ… Ø­Ø³Ù†',
                        motherName: 'Ù‡Ø¯Ù‰ Ù…Ø­Ù…ÙˆØ¯',
                        registry: 'Ø§Ù„Ø­ÙˆØ´/2008',
                        phone: '03678901',
                        floor: '5',
                        sectionType: 'Ù…Ø³ØªÙˆØ¯Ø¹',
                        direction: 'Ø´Ø±Ù‚'
                    }
                ]
            };

            // Save to localStorage
            localStorage.setItem('submission_' + Date.now() + '_1', JSON.stringify(data1));
            localStorage.setItem('submission_' + Date.now() + '_2', JSON.stringify(data2));
            localStorage.setItem('submission_' + Date.now() + '_3', JSON.stringify(data3));

            const message = document.getElementById('message');
            message.style.display = 'block';
            message.innerHTML = 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© 3 Ø³Ø¬Ù„Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!<br>- Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ (Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø§Ø¯ÙŠ)<br>- Ø³Ø¬Ù„ Ø¨Ø·ÙˆØ§Ø¨Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø© (2 Ø·ÙˆØ§Ø¨Ù‚ Ø¥Ø¶Ø§ÙÙŠØ©)<br>- Ø³Ø¬Ù„ Ù…Ø¨Ù†Ù‰ ÙƒØ§Ù…Ù„ (3 Ø³ÙƒØ§Ù†)';
            
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }

        function exportToExcel() {
            try {
                const submissions = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('submission_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        submissions.push(data);
                    }
                }

                if (submissions.length === 0) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹.');
                    return;
                }

                const excelData = [];
                
                submissions.forEach((submission, index) => {
                    const baseInfo = {
                        'Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„': index + 1,
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„': submission.timestamp || '',
                        'Ø§Ù„Ù‚Ø·Ø§Ø¹': submission.sector || '',
                        'Ø§Ù„Ù‚Ø±ÙŠØ©': submission.village || '',
                        'Ø§Ù„Ø­ÙŠ': submission.neighborhood || '',
                        'Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰': submission.buildingName || '',
                        'Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹': submission.streetName || '',
                        'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±': submission.propertyNumber || '',
                        'Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ù…': submission.sectionNumber || '',
                        'Ø¶Ù…Ù† Ù…Ø¨Ù†Ù‰': submission.isInBuilding ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                        'Ø±Ù‚Ù… Ø§Ù„ÙƒØªÙ„Ø©/Ø§Ù„Ù…Ø¨Ù†Ù‰': submission.blockNumber || '',
                        'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ': submission.buildingCount || '',
                        'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¨Ù†Ù‰': submission.buildingType || '',
                        'Ø¹Ø¯Ø¯ Ø§Ù„Ø·ÙˆØ§Ø¨Ù‚': submission.floors || '',
                        'Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ø¨Ù‚': submission.floorNumber || '',
                        'Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ù…': submission.sectionType || '',
                        'Ø§Ù„Ø§ØªØ¬Ø§Ù‡': submission.direction || '',
                        'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„': submission.fullName || '',
                        'Ø§Ø³Ù… Ø§Ù„Ø£Ù…': submission.motherName || '',
                        'Ø§Ù„Ù‚ÙŠØ¯': submission.registry || '',
                        'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': submission.phone || ''
                    };

                    if (submission.myFloors && submission.myFloors.length > 0) {
                        baseInfo['Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„'] = 'Ø·ÙˆØ§Ø¨Ù‚ Ù…Ø³Ø¬Ù„Ø© Ø¨Ø§Ø³Ù…ÙŠ';
                        baseInfo['Ø¹Ø¯Ø¯ Ø§Ù„Ø·ÙˆØ§Ø¨Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©'] = submission.myFloors.length;
                        
                        submission.myFloors.forEach((floor, floorIndex) => {
                            const floorData = { ...baseInfo };
                            floorData['Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„'] = `${index + 1}.${floorIndex + 1}`;
                            floorData['Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ'] = floor.floorNumber || '';
                            floorData['Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ'] = floor.sectionType || '';
                            floorData['Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ'] = floor.direction || '';
                            floorData['Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¬Ù„'] = floor.registrantName || '';
                            excelData.push(floorData);
                        });
                    } else if (submission.residents && submission.residents.length > 0) {
                        baseInfo['Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„'] = 'Ù…Ø¨Ù†Ù‰ ÙƒØ§Ù…Ù„';
                        baseInfo['Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†'] = submission.residents.length;
                        
                        submission.residents.forEach((resident, residentIndex) => {
                            const residentData = { ...baseInfo };
                            residentData['Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„'] = `${index + 1}.${residentIndex + 1}`;
                            residentData['Ø§Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.fullName || '';
                            residentData['Ø§Ø³Ù… Ø£Ù… Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.motherName || '';
                            residentData['Ù‚ÙŠØ¯ Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.registry || '';
                            residentData['Ù‡Ø§ØªÙ Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.phone || '';
                            residentData['Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.floor || '';
                            residentData['Ù†ÙˆØ¹ Ù‚Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.sectionType || '';
                            residentData['Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø§ÙƒÙ†'] = resident.direction || '';
                            excelData.push(residentData);
                        });
                    } else {
                        baseInfo['Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„'] = 'Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø­Ø¯';
                        excelData.push(baseInfo);
                    }
                });

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                ws['!cols'] = Array(25).fill({ wch: 15 });

                XLSX.utils.book_append_sheet(wb, ws, 'Ø­ØµØ± Ø§Ù„Ø£Ø¶Ø±Ø§Ø±');

                const now = new Date();
                const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}`;
                const filename = `Ø­ØµØ±_Ø§Ù„Ø£Ø¶Ø±Ø§Ø±_${dateStr}.xlsx`;

                XLSX.writeFile(wb, filename);

                const message = document.getElementById('message');
                message.style.display = 'block';
                message.innerHTML = `âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${submissions.length} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­!<br>ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${filename}<br>ğŸ“ ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª`;
                
                setTimeout(() => {
                    message.style.display = 'none';
                }, 8000);

            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
            }
        }

        function viewStoredData() {
            const submissions = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('submission_')) {
                    submissions.push(localStorage.getItem(key));
                }
            }

            const display = document.getElementById('dataDisplay');
            if (submissions.length === 0) {
                display.innerHTML = '<div class="info"><strong>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø©</strong></div>';
            } else {
                display.innerHTML = `<div class="info"><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©: ${submissions.length}</strong><pre>${JSON.stringify(JSON.parse(submissions[0]), null, 2)}</pre></div>`;
            }
        }

        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('submission_')) {
                        localStorage.removeItem(key);
                    }
                }
                const message = document.getElementById('message');
                message.style.display = 'block';
                message.innerHTML = 'ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                document.getElementById('dataDisplay').innerHTML = '';
                
                setTimeout(() => {
                    message.style.display = 'none';
                }, 3000);
            }
        }
    </script>
</body>
</html>
